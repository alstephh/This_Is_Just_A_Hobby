Metasplotable 2 use Postfix smtp which is a deamon of the email protcol
whit a simple banner grab with nc is specificaly ESMTP (E stands for Extended which allow to send attachments, intersting)

Important is to remind that obv the relay will send just to trusted host (usually auth with SASL or authorized host) otherwise
exist a denylist 
the SPF (Sender Policy Framework) provides this mechanism

The key for signing and validating email is a job of the DKIM (DomainKey Identified Mail)

[just a reminder : smtp is just for SENDING email for receive there is POP3/IMAP]

Even if I use nmap for a scan, this is a metasploit based machine so let me use the smtp_enum and see if something new pop out
(nothing new....but always a good thing try with multiple tool results can surprise you.....or this is what everyone said to me LOL)

There other methods for earn info on the email server like sending an email with a not-existing user on the domain if you lucky enough
can you receive the name of the AV (and more)

Online there a lot of spoofer fot check some misconfiguration that can be usefull not only for exploiting smtp but to make a idea of the 
system. (ex :/ pip3 install mailspoof)

But let's get our hands dirty again after the low result of the smtp_enum we just now ESMTP Postfix and the domain is metasploitable.localdomain
meanwhile im running the module smtp_enum trying to find some username that can help us

Actually is not needed we already have some username but I'going to pretend that we have do nothing before just scanning


smtp_enum discovered a huge amount of user (this illustrate us the real function as pentester of a SMTP port = enumeration and user discovery)

=============================================================================
backup, bin, daemon, distccd, ftp, games, gnats, irc, libuuid, 
list, lp, mail, man, mysql, news, nobody, postfix, postgres, postmaster
proxy, service, sshd, sync, sys, syslog, user, uucp, www-data
=============================================================================

Other than our friend user (underated and that's why we use him a lot ehehe) we can see that-s most of this are a hint of the protocol 
running on the system


Last thing on user enumeration there is another method for doing this (can be usefull if metasploit not imnstalled or ready somehow)

1] run netcat and connect to port 25
2] VRFY [username]
3] look at the response

there is a tool that can make this simple for us (called smtp-user-enum). The metasploit module do the same but can be usefull do it 
manually if you found just a few username whitout make noise with bruteforce


			BUT...HEY....WHERE IS THE SHELL?
Ok, let me explain
Usually SMTP is really hard if not impossible getting a reverse shell, we are talking of a mail protocol after all and everyone(?)
know that is a good way to make reverse shell, spoofing, social engineering, malware, eccetera so usually is one of the most protected
thing in the list of blue team so encryption, TLS service and good configuration of DKIM and SPF can get life really hard if you focus only
to get an attack directly on taht port (like FTP or something else)

But some good news are that some version of MES (Miscrosfot Exchange Server) and EXIM used for mail are higly vulnerable to some critical
exploit so if you make a good enumaration and scanning and find the version with some google search you will discover a weapon for SMTP

At the end I discovered that SMTP is a good resources bowl and using that information can be a support for a foothold on the system
(simple ex:/ with the user we found we can make a user list and try bruteforce with hydra or whatever you like)


